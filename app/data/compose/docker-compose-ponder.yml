version: '3.7'

services:
  ponder-app:
    restart: unless-stopped
    image: cerc/ponder:local
    workdir: /app/examples/token-erc20
    environment:
      PONDER_CHAIN_ID: ${PONDER_CHAIN_ID:-99}
      PONDER_RPC_URL_1: ${PONDER_RPC_URL_1:-http://nitro-reverse-payment-proxy:8081}
      CERC_PONDER_NITRO_PK: ${CERC_PONDER_NITRO_PK}
      CERC_PONDER_NITRO_CHAIN_PK: ${CERC_PONDER_NITRO_CHAIN_PK}
      CERC_PONDER_NITRO_CHAIN_URL: ${CERC_PONDER_NITRO_CHAIN_URL:-http://fixturenet-eth-geth-1:8545}
      CERC_RELAY_MULTIADDR: ${CERC_RELAY_MULTIADDR}
      CERC_UPSTREAM_NITRO_ADDRESS: ${CERC_UPSTREAM_NITRO_ADDRESS}
      CERC_UPSTREAM_NITRO_MULTIADDR: ${CERC_UPSTREAM_NITRO_MULTIADDR}
      CERC_UPSTREAM_NITRO_PAY_AMOUNT: ${CERC_UPSTREAM_NITRO_PAY_AMOUNT}
    command: ["bash", "ponder-app-start.sh"]
    volumes:
      - ../config/ponder/ponder-app-start.sh:/app/ponder-app-start.sh
      - ../config/ponder/ponder.config.ts:/app/ponder.config.ts
      - ../config/ponder/.env.local:/app/.env.local
      - peers_ids:/peers
      - nitro_deployment:/nitro
      - ponder_nitro_data:/app/.ponder/nitro-db
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  peers_ids:
  nitro_deployment:
  ponder_nitro_data:

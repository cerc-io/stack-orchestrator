version: '3.2'

services:
  # Deploys the sushiswap v3 subgraph
  sushiswap-subgraph-v3:
    image: cerc/sushiswap-subgraphs:local
    restart: on-failure
    depends_on:
      graph-node:
        condition: service_healthy
    environment:
      - APP=v3
      # - NETWORK=lotus-fixturenet
      - NETWORK=filecoin
    command: ["bash", "-c", "./v3/run-v3.sh && ./blocks/run-blocks.sh"]
    working_dir: /app/subgraphs
    volumes:
      - ../config/sushiswap-subgraph-v3/filecoin.js:/app/config/filecoin.js
      # - ../config/sushiswap-subgraph-v3/lotus-fixturenet.js.template:/app/config/lotus-fixturenet.js.template
      - ../config/sushiswap-subgraph-v3/run-v3.sh:/app/subgraphs/v3/run-v3.sh
      - ../config/sushiswap-subgraph-v3/run-blocks.sh:/app/subgraphs/blocks/run-blocks.sh
      # - sushiswap_core_deployment:/app/subgraphs/v3/core-deployments/docker
      # - sushiswap_periphery_deployment:/app/subgraphs/v3/deployments/docker
    extra_hosts:
      - "host.docker.internal:host-gateway"

# volumes:
#   sushiswap_core_deployment:
#   sushiswap_periphery_deployment:

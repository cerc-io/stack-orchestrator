version: "3.8"
services:
  laconicd:
    restart: unless-stopped
    image: cerc/laconicd:local
    env_file:
      # - ../config/laconic-explorer/laconic-explorer.env
      - $HOME/cerc/explorer/laconic-explorer.env
    command: ["sh", "/docker-entrypoint-scripts.d/setup-node.sh"]
    volumes:
      # TODO: look at folding these into the container
      - ../config/laconic-explorer/setup-node.sh:/docker-entrypoint-scripts.d/setup-node.sh
      - ${GENESIS_FILE}:/laconic-configs/genesis.json
    ports:
      - "${P2P_PORT:-27656}:26656"
      - "26657"
      - "1317"
  
  laconic-explorer:
    restart: unless-stopped
    image: cerc/laconic-explorer:local
    env_file:
      # - ../config/laconic-explorer/laconic-explorer.env
      - $HOME/cerc/explorer/laconic-explorer.env
    volumes:
      - /etc/letsencrypt/live/${EXPLORER_DOMAIN}:/etc/letsencrypt/live/${EXPLORER_DOMAIN}
      - /etc/letsencrypt/archive/${EXPLORER_DOMAIN}:/etc/letsencrypt/archive/${EXPLORER_DOMAIN}
      - ../config/laconic-explorer/ssl_configs/options-ssl-nginx.conf:/etc/letsencrypt/options-ssl-nginx.conf
      - ../config/laconic-explorer/ssl_configs/ssl-dhparams.pem:/etc/letsencrypt/ssl-dhparams.pem
    ports:
      - "80:80"
      - "443:443"
      - "${API_PORT:-1317}:1317"
      - "${RPC_PORT:-26657}:26657"

version: "3.2"

services:
  uniswap-interface:
    image: cerc/uniswap-interface:local
    restart: on-failure
    environment:
      - REACT_APP_INFURA_KEY=${CERC_INFURA_KEY}
    command: ["./build-app.sh"]
    volumes:
      - app_builds:/app-builds
      - ../config/uniswap-interface/build-app.sh:/app/build-app.sh

  uniswap-urbit-deployment:
    image: cerc/uniswap-urbit-deployment:local
    restart: unless-stopped
    depends_on:
      uniswap-interface:
        condition: service_completed_successfully
    # environment:
    #   - REACT_APP_INFURA_KEY=${CERC_INFURA_KEY}
    command: ["./deploy-to-urbit.sh"]
    volumes:
      - app_builds:/app-builds
      - urbit_data:/urbit
      - ../config/uniswap-interface/deploy-to-urbit.sh:/app/deploy-to-urbit.sh

volumes:
  app_builds:
  urbit_data:
